type: install
id: omeka-classic
name: Omeka Classic
homepage: https://omeka.org/classic/
baseUrl: https://raw.githubusercontent.com/reclaimhosting/omeka-classic-jps/master
logo: logo.png

description: 
  text: Omeka Classic is a web publishing platform for sharing digital collections and creating media-rich online exhibits. 
  
categories:
- apps/popular
- apps/content-management
- apps/education

globals:
  DB_NAME: omeka_${fn.random}

nodes:
  - nodeType: apache
    cloudlets: 16
  - nodeType: mysql
    cloudlets: 8

onInstall:
  - deployArchive
  - createDb
  - configApp
  - initInstall

actions:
  deployArchive:
    deploy:
      archive: https://github.com/omeka/Omeka/releases/download/v3.1.1/omeka-3.1.1.zip
      name: omeka-3.1.1
      context: ROOT
      
  createDb:
      cmd[sqldb]:
        mysql -uroot -p${nodes.mysql.password} -e "create database ${globals.DB_NAME}" 2>&1 1>/dev/null

  configApp:
    cmd[cp]: |-
      sed -i 's|username = "XXXXXXX"|username = "root"|g' /var/www/webroot/ROOT/db.ini;
      sed -i 's|password = "XXXXXXX"|password = "${nodes.mysql.password}"|g' /var/www/webroot/ROOT/db.ini;
      sed -i 's|dbname   = "XXXXXXX"|dbname   = "${globals.DB_NAME}"|g' /var/www/webroot/ROOT/db.ini;
      sed -i 's|host     = "XXXXXXX"|host     = "${nodes.cp.master.intIP}"|g' /var/www/webroot/ROOT/db.ini;
      
ssl: true
skipNodeEmails: true

success: success.md
